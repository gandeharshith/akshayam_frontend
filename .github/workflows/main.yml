name: Keep Backend Alive

on:
  schedule:
    # Run every 5 minutes
    - cron: '*/5 * * * *'
  workflow_dispatch: # Allow manual trigger

jobs:
  ping-backend:
    runs-on: ubuntu-latest
    
    steps:
    - name: Ping Backend Health Endpoint
      run: |
        echo "ğŸš€ Pinging backend to keep it alive..."
        
        # Replace this URL with your actual backend health endpoint
        BACKEND_URL="${{ secrets.BACKEND_URL || 'https://your-backend-url.com' }}/health"
        
        echo "ğŸ“¡ Pinging: $BACKEND_URL"
        
        # Ping the backend with timeout and retry
        for i in {1..8}; do
          if curl -f -s -m 10 "$BACKEND_URL" > /dev/null 2>&1; then
            echo "âœ… Backend ping successful (attempt $i)"
            curl -s "$BACKEND_URL" | head -c 200
            echo ""
            echo "â° Ping completed at $(date -u '+%Y-%m-%d %H:%M:%S UTC')"
            exit 0
          else
            echo "âŒ Backend ping failed (attempt $i)"
            if [ $i -lt 3 ]; then
              echo "ğŸ”„ Retrying in 10 seconds..."
              sleep 10
            fi
          fi
        done
        
        echo "ğŸ’€ All ping attempts failed"
        exit 1
      
    - name: Log Status
      run: |
        echo "ğŸ“Š Keep-alive job completed"
        echo "âš¡ Next run scheduled in 5 minutes"
